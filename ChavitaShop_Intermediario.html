<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Agregando al carrito...</title>
  <script>
    function getCookie(name) {
      const value = "; " + document.cookie;
      const parts = value.split("; " + name + "=");
      if (parts.length === 2) return parts.pop().split(";").shift();
    }

    function setCookie(name, value, days = 365) {
      const d = new Date();
      d.setTime(d.getTime() + (days*24*60*60*1000));
      const expires = "expires=" + d.toUTCString();
      document.cookie = name + "=" + value + ";" + expires + ";path=/";
    }

    function agregarProducto(nombre, precio, imagen) {
      const producto = { nombre, precio, imagen };
      let carrito = [];

      const cookieCarrito = getCookie("carrito");
      if (cookieCarrito) {
        carrito = JSON.parse(decodeURIComponent(cookieCarrito));
      }

      carrito.push(producto);
      setCookie("carrito", encodeURIComponent(JSON.stringify(carrito)));
    }

    window.onload = function() {
      const params = new URLSearchParams(window.location.search);
      if (params.get('add') === '1') {
        agregarProducto(
          params.get('nombre'),
          parseFloat(params.get('precio')),
          params.get('imagen')
        );
      }

      // Redirige al carrito dentro del mismo iframe
      window.location.href = "ChavitaShop_Carrito.html";
    };
  </script>
</head>
<body>
  <p>Agregando al carrito...</p>
</body>
</html>
