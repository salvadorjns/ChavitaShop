<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Procesando carrito...</title>
  <script>
    function procesarCarrito() {
      const params = new URLSearchParams(window.location.search);
      
      if (params.get('add') === '1') {
        const producto = {
          id: params.get('id') || Date.now().toString(),
          nombre: params.get('nombre'),
          precio: parseFloat(params.get('precio')),
          imagen: params.get('imagen'),
          cantidad: parseInt(params.get('cantidad') || '1')
        };

        // Obtener carrito actual de localStorage
        let carrito = JSON.parse(localStorage.getItem('carrito-chavita') || '[]');
        
        // Verificar si el producto ya existe
        const itemExistente = carrito.find(item => item.id === producto.id);
        
        if (itemExistente) {
          itemExistente.cantidad += producto.cantidad;
        } else {
          carrito.push(producto);
        }
        
        // Guardar en localStorage
        localStorage.setItem('carrito-chavita', JSON.stringify(carrito));
        
        // Notificar al iframe padre
        if (window.opener) {
          window.opener.postMessage({ action: 'carrito-actualizado' }, '*');
        }
      }
      
      // Redirigir al carrito
      window.location.href = "ChavitaShop_Carrito.html";
    }

    window.onload = procesarCarrito;
  </script>
</head>
<body>
  <p>Procesando tu producto...</p>
</body>
</html>
